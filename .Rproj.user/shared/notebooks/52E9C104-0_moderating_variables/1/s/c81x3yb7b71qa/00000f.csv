"0","# Ensure plotting margins"
"0","par(mar = c(1, 1, 2, 1))"
"0",""
"0","# Create an empty results data frame"
"0","network_summary = data.frame("
"0","  class = numeric(),"
"0","  density = numeric(),"
"0","  reciprocity = numeric(),"
"0","  transitivity = numeric(),"
"0","  path_length_min = numeric(),"
"0","  path_length_max = numeric(),"
"0","  path_length_mean = numeric(),"
"0","  n_components = numeric(),"
"0","  largest_component_size = numeric(),"
"0","  stringsAsFactors = FALSE"
"0",")"
"0",""
"0","# Loop through each class"
"0","for (cls in classes) {"
"0","  # Subset edges and nodes for this class"
"0","  edges_sub = subset(edges, class == cls)"
"0","  nodes_sub = subset(nodes_extended, class == cls)"
"0","  "
"0","  # Build graph including all nodes"
"0","  g = graph_from_data_frame("
"0","    d = edges_sub[, c(""source"", ""target"", ""class"", ""school"")],"
"0","    vertices = nodes_sub,"
"0","    directed = TRUE"
"0","  )"
"0","  "
"0","  # Compute network metrics"
"0","  "
"0","  dens = round(edge_density(g, loops = FALSE),3) # Density"
"0","  rec = round(reciprocity(g),3) # Reciprocity (only makes sense for directed graphs)"
"0","  trans = round(transitivity(g, type = ""global""),3) # Transitivity (global clustering coefficient)"
"0","  "
"0","  # Shortest path lengths"
"0","  dists = distances(g)"
"0","  dists[is.infinite(dists)] = NA  # ignore disconnected pairs"
"0","  path_min = min(dists, na.rm = TRUE)"
"0","  path_max = max(dists, na.rm = TRUE)"
"0","  path_mean = round(mean(dists, na.rm = TRUE),3)"
"0","  "
"0","  # Connected components"
"0","  comps = components(g, mode = ""weak"")"
"0","  n_comp = comps$no"
"0","  largest_comp = max(comps$csize)"
"0","  "
"0","  # Store results"
"0","  network_summary = rbind(network_summary, data.frame("
"0","    class = cls,"
"0","    density = dens,"
"0","    reciprocity = rec,"
"0","    transitivity = trans,"
"0","    path_length_min = path_min,"
"0","    path_length_max = path_max,"
"0","    path_length_mean = path_mean,"
"0","    n_components = n_comp,"
"0","    largest_component_size = largest_comp"
"0","  ))"
"0","  "
"0","  # Plot each network"
"0","  plot("
"0","    g,"
"0","    main = paste(""Network for Class"", cls),"
"0","    edge.width = 0.5,"
"0","    vertex.size = 15,"
"0","    vertex.label.cex = 0.8,"
"0","    layout = layout_with_fr"
"0","  )"
"0","}"
