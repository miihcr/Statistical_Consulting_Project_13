"0","# Add new column: mean per row (ignore missing values)"
"0","data$susceptibility = round(rowMeans(data[, all_items], na.rm = TRUE),2)"
"0",""
"0","# For missing values: Compute class means for susceptibility"
"0","class_means = tapply(data$susceptibility, data$class, mean, na.rm = TRUE)"
"0",""
"0","for (i in 1:nrow(data)) {"
"0","  if (is.na(data$susceptibility[i])) {"
"0","    cls <- data$class[i]"
"0","    data$susceptibility[i] <- class_means[as.character(cls)]"
"0","  }"
"0","}"
"0",""
"0",""
"0","# Add cohesion (density per class from network_summary)"
"0","data = merge(data,"
"0","              network_summary[, c(""class"", ""density"")],"
"0","              by = ""class"","
"0","              all.x = TRUE)"
"0",""
"0","names(data)[names(data) == ""density""] = ""cohesion"""
"0",""
"0",""
"0","# RDS saves the factors etc "
"0","saveRDS("
"0","  data,"
"0","  here::here(""data"",""processed"",""data2_incl_moderation.rds"")"
"0",")"
"0",""
"0",""
