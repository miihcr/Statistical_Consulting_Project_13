"0",""
"0","# Step 1: Test whether classroom random intercept is needed"
"0",""
"0","m1 <- glmer("
"0","  choice ~ target*group*block + reward*effort + school +"
"0","    (1 | ppn) + (1 | class),"
"0","  data = df_long, family = binomial, control = ctrl"
"0",")"
"0",""
"0","m1_simpler <- glmer("
"0","  choice ~ target*group*block + reward*effort + school +"
"0","    (1 | ppn),"
"0","  data = df_long, family = binomial, control = ctrl"
"0",")"
"0",""
"0","# Compare models"
"0","print(anova(m1_simpler, m1, test = ""Chisq""))"
"1","Data: df_long"
"1","
"
"1","Models:"
"1","
"
"1","m1_simpler: choice ~ target * group * block + reward * effort + school + (1 | ppn)"
"1","
"
"1","m1: choice ~ target * group * block + reward * effort + school + (1 | ppn) + (1 | class)"
"1","
"
"1","          "
"1"," npar"
"1","    AIC"
"1","    BIC"
"1","  logLik"
"1"," -2*log(L)"
"1"," Chisq"
"1"," Df"
"1"," Pr(>Chisq)"
"1","
m1_simpler"
"1","   26"
"1"," 2556.5"
"1"," 2730.1"
"1"," -1252.2"
"1","    2504.5"
"1","      "
"1","   "
"1","           "
"1","
m1        "
"1","   27"
"1"," 2558.5"
"1"," 2738.8"
"1"," -1252.2"
"1","    2504.5"
"1","     0"
"1","  1"
"1","     0.9999"
"1","
"
"0","print(isSingular(m1))"
"1","[1]"
"1"," TRUE"
"1","
"
"0","print(VarCorr(m1))"
"1",""
"1"," Groups"
"1"," Name       "
"1"," Std.Dev."
"1","
"
"1"," ppn   "
"1"," (Intercept)"
"1"," 1.4365  "
"1","
"
"1"," class "
"1"," (Intercept)"
"1"," 0.0000  "
"1","
"
"0","# Step 2: Add random slope for Block"
"0","m2 <- glmer("
"0","  choice ~ target*group*block + reward*effort + school +"
"0","    (1 + block | ppn),"
"0","  data = df_long, family = binomial, control = ctrl"
"0",")"
"0",""
"0","# Compare models"
"0",""
"0","print(anova(m1_simpler, m2, test = ""Chisq"")) # model 2 is better"
"1","Data: df_long"
"1","
"
"1","Models:"
"1","
"
"1","m1_simpler: choice ~ target * group * block + reward * effort + school + (1 | ppn)"
"1","
"
"1","m2: choice ~ target * group * block + reward * effort + school + (1 + block | ppn)"
"1","
"
"1","          "
"1"," npar"
"1","    AIC"
"1","    BIC"
"1","  logLik"
"1"," -2*log(L)"
"1","  Chisq"
"1"," Df"
"1"," Pr(>Chisq)"
"1","    "
"1","
m1_simpler"
"1","   26"
"1"," 2556.5"
"1"," 2730.1"
"1"," -1252.2"
"1","    2504.5"
"1","       "
"1","   "
"1","           "
"1","    "
"1","
m2        "
"1","   28"
"1"," 2456.0"
"1"," 2643.0"
"1"," -1200.0"
"1","    2400.0"
"1"," 104.44"
"1","  2"
"1","  < 2.2e-16"
"1"," ***"
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"0","cat(""\nIs m2 singular? "", isSingular(m2), ""\n"")"
"1","
Is m2 singular? "
"1"," "
"1","FALSE"
"1"," "
"1","
"
"0","print(VarCorr(m2))"
"1",""
"1"," Groups"
"1"," Name       "
"1"," Std.Dev."
"1"," Corr  "
"1","
"
"1"," ppn   "
"1"," (Intercept)"
"1"," 1.8772  "
"1","       "
"1","
"
"1","       "
"1"," block1     "
"1"," 1.1292  "
"1"," -0.762"
"1","
"
"0","# Choose final model "
"0","final_model <- m2"
"0",""
"0",""
"0","print(summary(final_model))"
"1","Generalized linear mixed model fit by maximum likelihood (Laplace Approximation) ['glmerMod']
"
"1"," Family:"
"1"," "
"1","binomial"
"1"," "
"1"," ( logit )"
"1","
"
"1","Formula:"
"1"," "
"1","choice ~ target * group * block + reward * effort + school + "
"1"," "
"1","    (1 + block | ppn)"
"1","
"
"1","   Data:"
"1"," "
"1","df_long"
"1","
"
"1","Control:"
"1"," "
"1","ctrl"
"1","
"
"1","
"
"1","      AIC "
"1","      BIC "
"1","   logLik "
"1","-2*log(L) "
"1"," df.resid "
"1","
"
"1","     2456 "
"1","     2643 "
"1","    -1200 "
"1","     2400 "
"1","     5848 "
"1","
"
"1","
"
"1","Scaled residuals:"
"1"," "
"1","
"
"1","    Min "
"1","     1Q "
"1"," Median "
"1","     3Q "
"1","    Max "
"1","
"
"1","-9.9109 "
"1"," 0.0422 "
"1"," 0.1155 "
"1"," 0.2311 "
"1"," 3.2089 "
"1","
"
"1","
"
"1","Random effects:
"
"1",""
"1"," Groups"
"1"," Name       "
"1"," Variance"
"1"," Std.Dev."
"1"," Corr "
"1","
"
"1"," ppn   "
"1"," (Intercept)"
"1"," 3.524   "
"1"," 1.877   "
"1","      "
"1","
"
"1","       "
"1"," block1     "
"1"," 1.275   "
"1"," 1.129   "
"1"," -0.76"
"1","
"
"1","Number of obs: 5876, groups: "
"1"," "
"1","ppn, 164"
"1","
"
"1","
Fixed effects:
"
"1","                     "
"1"," Estimate"
"1"," Std. Error"
"1"," z value"
"1"," Pr(>|z|)"
"1","    "
"1","
(Intercept)          "
"1","  4.28443"
"1","    0.25127"
"1","  17.051"
"1","  < 2e-16"
"1"," ***"
"1","
target1              "
"1","  0.24868"
"1","    0.09173"
"1","   2.711"
"1"," 0.006705"
"1"," ** "
"1","
target2              "
"1"," -0.08745"
"1","    0.08548"
"1","  -1.023"
"1"," 0.306254"
"1","    "
"1","
group1               "
"1"," -0.08868"
"1","    0.24872"
"1","  -0.357"
"1"," 0.721442"
"1","    "
"1","
group2               "
"1","  0.05482"
"1","    0.25099"
"1","   0.218"
"1"," 0.827104"
"1","    "
"1","
block1               "
"1"," -1.08859"
"1","    0.20556"
"1","  -5.296"
"1"," 1.19e-07"
"1"," ***"
"1","
reward1              "
"1"," -0.97327"
"1","    0.08510"
"1"," -11.437"
"1","  < 2e-16"
"1"," ***"
"1","
reward2              "
"1","  0.34876"
"1","    0.09572"
"1","   3.643"
"1"," 0.000269"
"1"," ***"
"1","
effort1              "
"1","  0.60757"
"1","    0.06722"
"1","   9.039"
"1","  < 2e-16"
"1"," ***"
"1","
school1              "
"1"," -0.05248"
"1","    0.22208"
"1","  -0.236"
"1"," 0.813204"
"1","    "
"1","
school2              "
"1"," -0.43223"
"1","    0.18245"
"1","  -2.369"
"1"," 0.017835"
"1"," *  "
"1","
target1:group1       "
"1"," -0.18547"
"1","    0.12158"
"1","  -1.526"
"1"," 0.127114"
"1","    "
"1","
target2:group1       "
"1"," -0.01898"
"1","    0.11602"
"1","  -0.164"
"1"," 0.870054"
"1","    "
"1","
target1:group2       "
"1","  0.45266"
"1","    0.14013"
"1","   3.230"
"1"," 0.001236"
"1"," ** "
"1","
target2:group2       "
"1"," -0.14736"
"1","    0.12330"
"1","  -1.195"
"1"," 0.232045"
"1","    "
"1","
target1:block1       "
"1"," -0.12997"
"1","    0.09165"
"1","  -1.418"
"1"," 0.156147"
"1","    "
"1","
target2:block1       "
"1","  0.11889"
"1","    0.08549"
"1","   1.391"
"1"," 0.164353"
"1","    "
"1","
group1:block1        "
"1"," -0.02666"
"1","    0.17813"
"1","  -0.150"
"1"," 0.881036"
"1","    "
"1","
group2:block1        "
"1"," -0.11094"
"1","    0.18118"
"1","  -0.612"
"1"," 0.540341"
"1","    "
"1","
reward1:effort1      "
"1","  0.30757"
"1","    0.08327"
"1","   3.694"
"1"," 0.000221"
"1"," ***"
"1","
reward2:effort1      "
"1"," -0.18005"
"1","    0.09552"
"1","  -1.885"
"1"," 0.059428"
"1"," .  "
"1","
target1:group1:block1"
"1","  0.03668"
"1","    0.12154"
"1","   0.302"
"1"," 0.762830"
"1","    "
"1","
target2:group1:block1"
"1"," -0.08476"
"1","    0.11602"
"1","  -0.731"
"1"," 0.465036"
"1","    "
"1","
target1:group2:block1"
"1"," -0.25864"
"1","    0.13997"
"1","  -1.848"
"1"," 0.064631"
"1"," .  "
"1","
target2:group2:block1"
"1","  0.26552"
"1","    0.12336"
"1","   2.152"
"1"," 0.031368"
"1"," *  "
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"0","# Fixed Effects"
"0",""
"0","print(Anova(final_model, type = 3))"
"1","Analysis of Deviance Table (Type III Wald chisquare tests)
"
"1","
"
"1","Response: choice"
"1","
"
"1","                  "
"1","    Chisq"
"1"," Df"
"1"," Pr(>Chisq)"
"1","    "
"1","
(Intercept)       "
"1"," 290.7440"
"1","  1"
"1","  < 2.2e-16"
"1"," ***"
"1","
target            "
"1","   7.6437"
"1","  2"
"1","  0.0218868"
"1"," *  "
"1","
group             "
"1","   0.1295"
"1","  2"
"1","  0.9373236"
"1","    "
"1","
block             "
"1","  28.0445"
"1","  1"
"1","  1.186e-07"
"1"," ***"
"1","
reward            "
"1"," 131.2048"
"1","  2"
"1","  < 2.2e-16"
"1"," ***"
"1","
effort            "
"1","  81.7040"
"1","  1"
"1","  < 2.2e-16"
"1"," ***"
"1","
school            "
"1","  10.0246"
"1","  2"
"1","  0.0066557"
"1"," ** "
"1","
target:group      "
"1","  11.8938"
"1","  4"
"1","  0.0181588"
"1"," *  "
"1","
target:block      "
"1","   2.5538"
"1","  2"
"1","  0.2788984"
"1","    "
"1","
group:block       "
"1","   0.6549"
"1","  2"
"1","  0.7207550"
"1","    "
"1","
reward:effort     "
"1","  13.9762"
"1","  2"
"1","  0.0009228"
"1"," ***"
"1","
target:group:block"
"1","   5.8352"
"1","  4"
"1","  0.2117988"
"1","    "
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
