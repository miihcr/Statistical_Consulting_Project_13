summarise(
n_participants = n(),
n_at_90 = sum(prop_high_effort >= 0.90),
pct_at_90 = mean(prop_high_effort >= 0.90) * 100,
mean_prop = mean(prop_high_effort),
sd_prop = sd(prop_high_effort),
median_prop = median(prop_high_effort)
)
print(ceiling_by_group)
0.0840 * 100
0.0990 * 100
# Comprehensive summary table
ceiling_summary <- df_long |>
group_by(ppn) |>
summarise(
n_trials = n(),
n_valid = sum(!is.na(choice)),
prop = if_else(n_valid > 0, mean(choice, na.rm = TRUE), NA_real_),
sd = if_else(n_valid > 1, sd(choice, na.rm = TRUE), NA_real_)
) |>
filter(!is.na(prop)) |>  # Remove participants with no valid data
summarise(
n_participants = n(),
mean = mean(prop),
sd = sd(prop),
median = median(prop),
q25 = quantile(prop, 0.25),
q75 = quantile(prop, 0.75),
min = min(prop),
max = max(prop),
n_90 = sum(prop >= 0.90),
pct_90 = mean(prop >= 0.90) * 100,
n_95 = sum(prop >= 0.95),
pct_95 = mean(prop >= 0.95) * 100,
n_100 = sum(prop == 1.00),
pct_100 = mean(prop == 1.00) * 100,
mean_within_sd = mean(sd, na.rm = TRUE),
n_zero_var = sum(sd == 0, na.rm = TRUE),
pct_zero_var = mean(sd == 0, na.rm = TRUE) * 100
)
0.107 * 100
# By participant and block
ceiling_by_block <- df_long |>
group_by(ppn, block) |>
summarise(
n_trials = n(),
n_valid = sum(!is.na(choice)),
prop_high_effort = if_else(n_valid > 0, mean(choice, na.rm = TRUE), NA_real_),
.groups = "drop"
) |>
filter(!is.na(prop_high_effort)) |>  # Remove participants with no valid data in that block
group_by(block) |>
summarise(
n_participants = n(),
n_at_90 = sum(prop_high_effort >= 0.90),
pct_at_90 = mean(prop_high_effort >= 0.90) * 100,
n_at_95 = sum(prop_high_effort >= 0.95),
pct_at_95 = mean(prop_high_effort >= 0.95) * 100,
n_at_100 = sum(prop_high_effort == 1.00),
pct_at_100 = mean(prop_high_effort == 1.00) * 100
)
print(ceiling_by_block)
# By group and block (most important!)
df_long |>
group_by(group, block) |>
summarise(
n_trials = n(),
n_valid = sum(!is.na(choice)),
n_missing = sum(is.na(choice)),
mean_choice = mean(choice, na.rm = TRUE),
sd_choice = sd(choice, na.rm = TRUE),
.groups = "drop"
)
# By target type
df_long |>
group_by(target) |>
summarise(
n_trials = n(),
n_valid = sum(!is.na(choice)),
n_missing = sum(is.na(choice)),
mean_choice = mean(choice, na.rm = TRUE),
sd_choice = sd(choice, na.rm = TRUE)
)
# By all three factors
df_long |>
group_by(target, group, block) |>
summarise(
n_trials = n(),
n_valid = sum(!is.na(choice)),
M = mean(choice, na.rm = TRUE),
SD = sd(choice, na.rm = TRUE),
.groups = "drop"
) |>
arrange(target, group, block)
0.876 - 0.932
0.876 - 0.932 * 100
0.932 - 0.876
0.056 * 100
# Reward × Effort interaction pattern
df_long |>
group_by(reward, effort) |>
summarise(
n_trials = n(),
n_valid = sum(!is.na(choice)),
mean_choice = mean(choice, na.rm = TRUE),
sd_choice = sd(choice, na.rm = TRUE),
.groups = "drop"
)
# Choice rates by effort level
df_long |>
group_by(effort) |>
summarise(
n_trials = n(),
n_valid = sum(!is.na(choice)),
mean_choice = mean(choice, na.rm = TRUE),
sd_choice = sd(choice, na.rm = TRUE)
)
# Choice rates by reward level
df_long |>
group_by(reward) |>
summarise(
n_trials = n(),
n_valid = sum(!is.na(choice)),
mean_choice = mean(choice, na.rm = TRUE),
sd_choice = sd(choice, na.rm = TRUE)
)
# Reward × Effort interaction pattern
df_long |>
group_by(reward, effort) |>
summarise(
n_trials = n(),
n_valid = sum(!is.na(choice)),
mean_choice = mean(choice, na.rm = TRUE),
sd_choice = sd(choice, na.rm = TRUE),
.groups = "drop"
)
# By group and block (most important!)
df_long |>
group_by(group, block) |>
summarise(
n_trials = n(),
n_valid = sum(!is.na(choice)),
n_missing = sum(is.na(choice)),
mean_choice = mean(choice, na.rm = TRUE),
sd_choice = sd(choice, na.rm = TRUE),
.groups = "drop"
)
# Prepare data for Table 1: Group × Block
table1_data <- df_long %>%
group_by(group, block) %>%
summarise(
mean_choice = mean(choice, na.rm = TRUE),
se = sd(choice, na.rm = TRUE) / sqrt(n()),
.groups = "drop"
)
# Figure for Table 1: Group × Block interaction
fig_table1 <- ggplot(table1_data, aes(x = block, y = mean_choice,
group = group, color = group)) +
geom_line(size = 1.2) +
geom_point(size = 3) +
geom_errorbar(aes(ymin = mean_choice - se, ymax = mean_choice + se),
width = 0.1, size = 0.8) +
scale_y_continuous(limits = c(0.85, 1),
breaks = seq(0.85, 1, 0.025),
labels = scales::percent_format(accuracy = 1)) +
scale_color_manual(values = c("control" = "#1f77b4",
"positive_norm" = "#2ca02c",
"negative_norm" = "#d62728"),
labels = c("Control", "Positive Norm", "Negative Norm")) +
labs(x = "Block",
y = "Proportion of High-Effort Choices",
color = "Group",
title = "Pre-to-Post Changes in High-Effort Choices by Group") +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom")
print(fig_table1)
# Prepare data for Table 2: Target × Group × Block
table2_data <- df_long %>%
group_by(target, group, block) %>%
summarise(
mean_choice = mean(choice, na.rm = TRUE),
se = sd(choice, na.rm = TRUE) / sqrt(n()),
.groups = "drop"
)
# Figure for Table 2: Three-way interaction (faceted by target)
fig_table2 <- ggplot(table2_data, aes(x = block, y = mean_choice,
group = group, color = group)) +
geom_line(size = 1.2) +
geom_point(size = 3) +
geom_errorbar(aes(ymin = mean_choice - se, ymax = mean_choice + se),
width = 0.1, size = 0.8) +
facet_wrap(~ target, ncol = 3) +
scale_y_continuous(limits = c(0.82, 1),
breaks = seq(0.85, 1, 0.05),
labels = scales::percent_format(accuracy = 1)) +
scale_color_manual(values = c("control" = "#1f77b4",
"positive_norm" = "#2ca02c",
"negative_norm" = "#d62728"),
labels = c("Control", "Positive Norm", "Negative Norm")) +
labs(x = "Block",
y = "Proportion of High-Effort Choices",
color = "Group",
title = "Pre-to-Post Changes by Target Type and Group") +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom",
strip.text = element_text(face = "bold"))
print(fig_table2)
plot_b_data <- df_long |>
group_by(group, block, target) |>
summarise(
p_choice = mean(choice == 1, na.rm = TRUE),
n       = sum(!is.na(choice)),
.groups = "drop"
)
target_block_group_plot <- plot_b_data |>
ggplot(aes(x = block,
y = p_choice,
color = target,
group = target)) +
geom_point(size = 3) +
geom_line(size = 1) +
facet_wrap(~ group, labeller = labeller(group = group_labels)) +
labs(
x     = "Block",
y     = "Proportion of High-Effort Choices",
color = "Target"
) +
scale_y_continuous(limits = c(0, 1)) +
scale_color_manual(values = pal_target) +
theme_bw() +
theme(
legend.position = "top",
legend.title    = element_blank()
)
ggsave("figures/descriptives/target_block_group_plot.png",
plot = target_block_group_plot,
width = 7, height = 5, dpi = 300)
plot_b_data |>
ggplot(aes(x = block,
y = p_choice,
color = target,
group = target)) +
geom_point(size = 3) +
geom_line(size = 1) +
facet_wrap(~ target) +
labs(
x     = "Block",
y     = "Proportion of High-Effort Choices",
color = "Target"
) +
scale_y_continuous(limits = c(0, 1)) +
scale_color_manual(values = pal_target) +
theme_bw() +
theme(
legend.position = "top",
legend.title    = element_blank()
)
plot_b_data |>
ggplot(aes(x = block,
y = p_choice,
color = group,
group = group)) +
geom_point(size = 3) +
geom_line(size = 1) +
facet_wrap(~ target) +
labs(
x     = "Block",
y     = "Proportion of High-Effort Choices",
color = "Target"
) +
scale_y_continuous(limits = c(0, 1)) +
scale_color_manual(values = pal_target) +
theme_bw() +
theme(
legend.position = "top",
legend.title    = element_blank()
)
plot_a_data <- df_long |>
group_by(reward, effort) |>
summarise(p = mean(choice == 1, na.rm = TRUE), .groups = "drop")
reward_effort_plot <- plot_a_data |>
ggplot(aes(x = reward, y = p, color = effort, group = effort)) +
geom_point(size = 3) +
geom_line(size = 1) +
scale_color_manual(values = c(
"40%" = "#E15759",
"90%" = "#4E79A7"
)) +
scale_y_continuous(limits = c(0, 1)) +
labs(
x = "Reward",
y = "Proportion of High-Effort Choices",
color = "Effort"
) +
theme_bw()
ggsave("figures/descriptives/reward_effort_plot.png",
plot = reward_effort_plot,
width = 7, height = 5, dpi = 300)
df_long |>
group_by(group, block, target) |>
summarise(
p_choice = mean(choice == 1, na.rm = TRUE),
n       = sum(!is.na(choice)),
.groups = "drop"
)
target_block_group_plot <- plot_b_data |>
ggplot(aes(x = block,
y = p_choice,
color = target,
group = target)) +
geom_point(size = 3) +
geom_line(size = 1) +
facet_wrap(~ group, labeller = labeller(group = group_labels)) +
labs(
x     = "Block",
y     = "Proportion of High-Effort Choices",
color = "Target"
) +
scale_y_continuous(limits = c(0, 1)) +
scale_color_manual(values = pal_target) +
theme_bw()
plot_b_data |>
ggplot(aes(x = block,
y = p_choice,
color = target,
group = target)) +
geom_point(size = 3) +
geom_line(size = 1) +
facet_wrap(~ group, labeller = labeller(group = group_labels)) +
labs(
x     = "Block",
y     = "Proportion of High-Effort Choices",
color = "Target"
) +
scale_y_continuous(limits = c(0, 1)) +
scale_color_manual(values = pal_target) +
theme_bw()
plot_b_data |>
ggplot(aes(x = block,
y = p_choice,
color = target,
group = target)) +
geom_point(size = 3) +
geom_line(size = 1) +
facet_wrap(~ group, labeller = labeller(group = group_labels)) +
labs(
x     = "Block",
y     = "Proportion of High-Effort Choices",
color = "Target"
) +
scale_y_continuous(limits = c(0.85, 1),
breaks = seq(0.85, 1, 0.025)) +
scale_color_manual(values = pal_target) +
theme_bw()
# Adjusting y axis to zoom in on the effect
zoomed_target_block_group_plot <- plot_b_data |>
ggplot(aes(x = block,
y = p_choice,
color = target,
group = target)) +
geom_point(size = 3) +
geom_line(size = 1) +
facet_wrap(~ group, labeller = labeller(group = group_labels)) +
labs(
x     = "Block",
y     = "Proportion of High-Effort Choices",
color = "Target"
) +
scale_y_continuous(limits = c(0.85, 1),
breaks = seq(0.85, 1, 0.025)) +
scale_color_manual(values = pal_target) +
theme_bw() +
theme(
legend.position = "top",
legend.title    = element_blank()
)
ggsave("figures/descriptives/zoomed_target_block_group_plot.png",
width = 7, height = 5, dpi = 300)
citation("semPlot")
# Reward × Effort interaction pattern
df_long |>
group_by(reward, effort) |>
summarise(
mean_choice = mean(choice, na.rm = TRUE),
sd_choice = sd(choice, na.rm = TRUE)
)
0.787 * 100
citation("ggeffects")
source(here::here("scripts","_common.R"), local = knitr::knit_global())
df_wide <- readRDS(here::here("data","processed","df_wide.rds"))
df_long <- readRDS(here::here("data","processed","df_long.rds"))
df_long <- df_long |>
mutate(
group  = relevel(group,  ref = "control"),
target = relevel(target, ref = "self"),
effort = relevel(effort, ref = "40%"),
block  = relevel(block,  ref = "pre")
)
options(contrasts = c("contr.treatment", "contr.poly"))
ctrl <- glmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 1e6))
# Full model with three-way interaction
m_full <- glmer(
choice ~ target * group * block + reward * effort + school +
(1 + block | ppn),
data = df_long,
family = binomial,
control = ctrl
)
plot_model(m_full, type = "fe")
library(sjPlot)
plot_model(m_full, type = "fe")
sjPlot::plot_model(m_full, type = "fe")
sjPlot::plot_model(m_full)
sjPlot::plot_model(m_full,
sort.est=T)
sjPlot::plot_model(m_full,
sort.est=T,
vline.color = "red")
theme_set(theme_sjplot())
sjPlot::plot_model(m_full,
sort.est=T,
vline.color = "red")
# Model estimates plot
theme_set(theme_sjplot())
sjPlot::plot_model(m_full,
sort.est=T,
vline.color = "red")
ggsave("figures/regression-plots/model-estimates.png",
width = 7, height = 5, dpi = 300)
sjPlot::plot_model(m_full,
sort.est=T,
vline.color = "red")
m_suscept_2b <- glmmTMB(
choice ~ target * group * block +
group * block * susceptibility_c +
reward * effort + school +
(1 + block | ppn),
data = df_long,
family = binomial
)
m_cohesion_3c <- glmmTMB(
choice ~ (group * block * target) +
(group * block * cohesion_z) +
(group * target * cohesion_z) +
(block * target * cohesion_z) +
reward * effort + school +
(1 + block | ppn),
data = df_long,
family = binomial
)
source(here::here("scripts","_common.R"), local = knitr::knit_global())
df_wide <- readRDS(here::here("data","processed","df_wide.rds"))
df_long <- readRDS(here::here("data","processed","df_long.rds"))
df_long <- df_long |>
mutate(
group  = relevel(group,  ref = "control"),
target = relevel(target, ref = "self"),
effort = relevel(effort, ref = "40%"),
block  = relevel(block,  ref = "pre")
)
options(contrasts = c("contr.treatment", "contr.poly"))
ctrl <- glmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 1e6))
# use directed
df_long$cohesion_z <- scale(df_long$cohesion_directed)[, 1]
m_cohesion_3c <- glmmTMB(
choice ~ (group * block * target) +
(group * block * cohesion_z) +
(group * target * cohesion_z) +
(block * target * cohesion_z) +
reward * effort + school +
(1 + block | ppn),
data = df_long,
family = binomial
)
sjPlot::plot_model(m_suscept_2b,
sort.est=T,
vline.color = "red")
# Model estimates plots
sjPlot::plot_model(m_suscept_2b,
sort.est=T,
vline.color = "red")
ggsave("figures/regression-plots/m-suscept-2b.png",
width = 7, height = 5, dpi = 300)
sjPlot::plot_model(m_cohesion_3c,
sort.est=T,
vline.color = "red")
ggsave("figures/regression-plots/m-cohesion-3c.png",
width = 7, height = 5, dpi = 300)
m_cohesion_3c <- glmmTMB(
choice ~ (group * block * target) +
(group * block * cohesion_z) +
(group * target * cohesion_z) +
(block * target * cohesion_z) +
reward * effort + school +
(1 + block | ppn),
data = df_long,
family = binomial
)
# Model estimates plots
sjPlot::plot_model(m_suscept_2b,
sort.est=T,
vline.color = "red")
ggsave("figures/regression-plots/m-suscept-2b.png",
width = 7, height = 5, dpi = 300)
sjPlot::plot_model(m_cohesion_3c,
sort.est=T,
vline.color = "red")
ggsave("figures/regression-plots/m-cohesion-3c.png",
width = 7, height = 5, dpi = 300)
citation("sjPlot")
citation("ggplot2")
git pull
